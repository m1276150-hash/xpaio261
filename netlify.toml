[build]
  # 리액트 앱 빌드 명령과 결과물 폴더 설정
  base = "frontend"
  # CI=false를 추가하여 사소한 경고로 인해 빌드가 중단되는 것을 방지합니다.
  command = "npm install && CI=false npm run build"
  publish = "build"

[build.environment]
  # webpack 4와의 호환성을 위해 Node 16 버전을 유지합니다.
  NODE_VERSION = "16.20.2"
  NPM_FLAGS = "--legacy-peer-deps"

[functions]
  # API 함수들이 들어있는 폴더 지정 (Netlify 서버리스 함수 경로)
  directory = "api"

[[redirects]]
  # 리액트 라우팅 보호: 새로고침 시 404 에러 방지
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  # 파이 네트워크 보안 정책 및 CORS 설정
  for = "/*"
  [headers.values]
    Access-Control-Allow-Origin = "*"
    Access-Control-Allow-Methods = "GET, POST, OPTIONS"
    Access-Control-Allow-Headers = "Content-Type, Authorization"
    # 파이 브라우저(샌드박스 및 pinet)에서 앱이 차단되지 않도록 허용 범위를 구체화합니다.
    Content-Security-Policy = "frame-ancestors 'self' https://sandbox.minepi.com https://*.pinet.com https://*.pi;"
    # 특정 브라우저에서 프레임을 허용하도록 설정 (Blocked 에러 해결 핵심)
    X-Frame-Options = "ALLOW-FROM https://sandbox.minepi.com"
    X-Content-Type-Options = "nosniff"

[[headers]]
  for = "/privacy.html"
  [headers.values]
    Content-Type = "text/html; charset=utf-8"

[[headers]]
  for = "/terms.html"
  [headers.values]
    Content-Type = "text/html; charset=utf-8"